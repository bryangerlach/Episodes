{% extends 'tvshow/header.html' %}

{% block content %}
<div class="card-group">
  <div class="card text-xs-center">
    <img class="card-img-top img-fluid mx-auto" src="{{show.banner}}" alt="Card image cap" width="300" height="900">
    <div class="card-block text-xs-center">
      <a target="_blank" href="https://www.imdb.com/title/{{show.imdbID}}"><h3 class="card-title text-xs-center">{{show.seriesName}}<small class="text-muted"> ({{show.network}})</small></h3></a>
      {% for genre in show.get_genres %}
        <span class="tag tag-pill tag-danger text-xs-center">{{genre.name}}</span>
      {% endfor %}
      <br>
      <br>
      {% if show.is_watched %}
        <progress class="progress progress-striped progress-success" value="{{show.episode_watch_count}}" max="{{show.total_episodes}}"></progress>
      {% else %}
        <progress class="progress progress-striped" value="{{show.episode_watch_count}}" max="{{show.total_episodes}}"></progress>
      {% endif %}
      <p class="card-text">
        {{show.overview}}
      </p>
      {% if not show.watch_later and not show.stopped_watching %}
        <button class="btn btn-danger" data-toggle="modal" data-target=".watch-later">Watch Later</button>
      {% else %}
      <button class="btn btn-danger" data-toggle="modal" data-target=".watch-now">Start Watching</button>
      {% endif %}
      {% if show.is_watched %}
      <button class="btn btn-danger" data-toggle="modal" data-target=".mark-all-unwatched">Mark All Unwatched</button>
      {% else %}
      <button class="btn btn-danger" data-toggle="modal" data-target=".mark-all-watched">Mark All Watched</button>
      {% endif %}
      {% if not show.stopped_watching %}
      <button class="btn btn-danger" data-toggle="modal" data-target=".stop-watching">Stop Watching</button>
      {% endif %}
      <button class="btn btn-danger" data-toggle="modal" data-target=".delete-show">Delete</button>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      Seasons
      <form class="form-inlne float-xs-right" action="/update_show" method="post">{% csrf_token %}
        <button type="submit" name="button" class="btn btn-warning btn-sm">Update</button>
        <input type="hidden" name="show_info" value="{{show.id}}">
      </form>
    </div>
    <div class="list-group list-group-flush">
      {% for season in show.season_set.all %}
      <a class="list-group-item" data-toggle="modal" data-target="#s{{season.number}}">
        Season {{season.number}} <small> Watched {{season.watch_count}} of {{season.episode_count}} episodes.</small>
      </a>
      {% endfor %}
    </div>
  </div>

  <div class="card">
    {% if next_episode %}
    <ul class="list-group">
      <li class="list-group-item list-group-item-success">Next to Watch</li>
      <li class="list-group-item">
        {{next_episode.number}}. <a data-toggle="collapse" href="#collapseE{{next_episode.number}}" aria-expanded="false" aria-controls="collapseE{{next_episode.number}}">{{next_episode.episodeName}}</a> <small>{{next_episode.firstAired}}</small>
        <form class='form-inline float-xs-right' action="/episode_swt" method="post">{% csrf_token %}
          <input type="hidden" name="episode_swt" value="{{next_episode.id}}">
          {% if next_episode.status_watched == True %}
          <input type="checkbox" onclick="this.form.submit();" checked>
          {% else %}
          <input type="checkbox" onclick="this.form.submit();">
          {% endif %}
        </form>
      </li>
      <div class="collapse" id="collapseE{{next_episode.number}}">
        <div class="card-block card-inverse card-danger">
          <p class="card-text">
            {{next_episode.overview}}
          </p>
        </div>
      </div>
    </ul>
    {% endif %}
    <br>
    <div class="card-block text-xs-center">
      <button class="btn btn-danger">Site Rating : {{show.siteRating|floatformat:"1"}}</button>
      <br>
      <br>
      <button class="btn btn-success" data-toggle="modal" data-target=".change-user-rating">Your Rating : {{show.userRating|floatformat:"1"}}</button>
    </div>
  </div>
</div>

<div class="modal fade change-user-rating" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">Modify Rating</h4>
      </div>
      <form action="/update_rating" method="post">{% csrf_token %}
      <div class="modal-body">
        <div class="input-group">
          <span class="input-group-addon" id="basic-addon3">Rating</span>
          <input type="number" class="form-control" name="new_rating" aria-describedby="basic-addon3" max=10 min=0 step=0.1 value="{{show.userRating|floatformat:'0'}}">
          <input type="hidden" value={{show.id}} name='show_id'>
      </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" class="btn btn-success">Save changes</button>
      </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade delete-show" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">All data will be deleted!!</h4>
        </div>
        <form action="/delete_show" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} and all its episodes will be deleted.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Delete</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

<div class="modal fade mark-all-unwatched" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">All Episodes will be cleared</h4>
        </div>
        <form action="/mark_all_unwatched" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} and all its episodes will be marked unwatched.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Unwatch</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

<div class="modal fade mark-all-watched" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">All episodes will be marked watched</h4>
        </div>
        <form action="/mark_all_watched" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} and all its episodes will be marked watched.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Mark Watched</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

<div class="modal fade watch-later" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Show will be watched later</h4>
        </div>
        <form action="/later" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} will be sent to Watch Later.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Watch Later</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

<div class="modal fade watch-now" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Start watching</h4>
        </div>
        <form action="/now" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} will be sent to Episodes.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Start Watching</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

<div class="modal fade stop-watching" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm">
    <div class="modal-content text-xs-center">
        <div class="modal-header">
          <h4 class="modal-title" id="myModalLabel">Stop watching</h4>
        </div>
        <form action="/stop" method="post">{% csrf_token %}
        <div class="modal-body">
            <p>
              {{show.seriesName}} will be sent to Stopped Watching.
            </p>
            <input type="hidden" value={{show.id}} name='show_id'>
        </div>
      <div class="modal-footer text-xs-center">
        <button type="button" class="btn btn-success" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-danger">Stop Watching</button>
      </div>
      </form>
    </div>
    </div>
  </div>
</div>

{% for season in show.season_set.all %}
{% include 'tvshow/single_season_modal_snippet.html' with season=season %}
{% endfor %}
{% endblock %}
